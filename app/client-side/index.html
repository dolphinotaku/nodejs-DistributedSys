<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Hotel Booking System by G603</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="lib/mustache/mustache.min.js"></script>
</head>
<body>
  <div id="loginFrm">
  <div id="background_container" class="ie_legacy">
	<img id="background_background_image" src="img/hotel-1200x800.jpg">
  </div>
  <div id="loginPanel">
		Hotel Booking System	
		<div id="loginErrMsg" class="err_msg">The username you entered cannot be identified.</div>
		<div>
		  <input type="text" class="textfield" name="loginId" id="loginId" placeholder="Username">
		</div>
		<div>
		  <input type="password" class="textfield" name="password" id="password" placeholder="Please enter your password">
		</div>
		<button type="button" onclick="login()">Login</button>
		<div id="footer">
		DCS Assignment <br />
		Prepared By Group-603
		</div>
  </div>
  </div>
  
	
  <div id="welcomeMsg">
  </div>  
  <div id="rooms-container">
  </div>
  
  <script id="rooms-view-template" type="x-tmpl-mustache">
      <table id="rooms">
          <tr>
            <th>ID</th>
            <th>Room No.</th>
            <th>Capacity</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
          {{#rooms}}
          <tr>
            <td>{{id}}</td>
            <td>{{code}}</td>
            <td>{{capacity}}</td>
            <td>
              {{#isBooked}}
                <span class="booked">Booked</span>
              {{/isBooked}}
              {{^isBooked}}
                <span>Available</span>
              {{/isBooked}}
            </td>
            <td class="text-center">
              {{#canCancel}}
              <button type="button" onclick="cancelRoomBooking({{id}})">Cancel</button>
              {{/canCancel}}
                {{^isBooked}}
              <button type="button" onclick="bookRoom({{id}})">Book</button>
                {{/isBooked}}
            </td>
          </tr>
          {{/rooms}}
        </table>
        <button type="button" onclick="logout()">Logout</button>
  </script>

</body>


<script src="/socket.io/socket.io.js"></script>
<script>
  var socket = io();
  
  // setInterval(function(){
    // socket.emit('client',new Date().getTime());
  // }, 1000);
  function login(){
    var loginId = document.getElementById('loginId').value;
    var password = document.getElementById('password').value;
    var account = {'id':loginId, 'password': password};
    console.log(account);
	
	//var logoutButton = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button type="button" onclick="logout()">Logout</button>';
	var logoutButton = '';

    socket.emit('login', account, function(resp){
      console.log(resp);
      if(resp.success){
	    document.getElementById('loginErrMsg').innerHTML="";
	    document.getElementById('loginErrMsg').style.display="none";
        alert('Login success');
		document.getElementById('loginFrm').style.display="none";
		
		document.getElementById('welcomeMsg').innerHTML="Welcome, <b>"+loginId+"</b>"+logoutButton;
		document.getElementById('welcomeMsg').style.display="block";
      }else{
        //alert('Login Fail');
		document.getElementById('loginErrMsg').innerHTML="The username or password you entered are incorrect.";
		document.getElementById('loginErrMsg').style.display="block";
      }
    });
  }
  
/*  function logout(){
    var loginId = document.getElementById('loginId').value;
    var password = document.getElementById('password').value;
    var account = {'id':loginId, 'password': password};
    console.log(account);
	
	socket.emit('logout', account, function(resp){
      console.log(resp);
      if(resp.success){
	    document.getElementById('loginErrMsg').innerHTML="";
	    document.getElementById('loginErrMsg').style.display="none";
        alert('Logout success');
		document.getElementById('loginFrm').style.display="block";
		
//		document.getElementById('welcomeMsg').innerHTML="Welcome, <b>"+loginId+"</b>"+logoutButton;
//		document.getElementById('welcomeMsg').style.display="block";
      }else{
        //alert('Login Fail');
//		document.getElementById('loginErrMsg').innerHTML="The username or password you entered are incorrect.";
//		document.getElementById('loginErrMsg').style.display="block";
      }
    });
  }	*/

  function bookRoom(id){
    socket.emit('rooms-update', [{'id':id, 'isBooked':true}], function(resp){
      console.log(resp);
    });
  }
  function logout(){
    window.location.reload();
    // socket.disconnect();

      // document.getElementById('loginErrMsg').innerHTML="";
      // document.getElementById('loginErrMsg').style.display="none";
      //   alert('Logout success');
      //   document.getElementById('loginFrm').style.display="block";
    
//    document.getElementById('welcomeMsg').innerHTML="Welcome, <b>"+loginId+"</b>"+logoutButton;
//    document.getElementById('welcomeMsg').style.display="block";
  }

  function cancelRoomBooking(id){
    socket.emit('rooms-update', [{'id':id, 'isBooked':false}], function(resp){
      console.log(resp);
    });
  }

  function renderRoomsView(rooms){

    var template = document.getElementById('rooms-view-template').text || '';
    // console.log('template:'+template);
    var loginId = document.getElementById('loginId').value;
    var output = Mustache.render(template, {'rooms':rooms, 'loginId':loginId});

    document.getElementById('rooms-container').innerHTML = output;

    // var table = document.createElement('table');
    // var tr = document.createElement('tr');
    // var td = document.createElement('td');

    // table.style.width = '100%';

    // rooms.forEach(function(room) {
    //   var id = room.id;
    //   var code = room.code;
    //   var isBooked = room.isBooked;

    //   var row = tr.cloneNode(true);

    //   var idCell = td.cloneNode();
    //   idCell.textContent = id;

    //   var codeCell = td.cloneNode();
    //   codeCell.textContent = code;

    //   var isBookedCell = td.cloneNode();
    //   isBookedCell.textContent = isBooked?'booked':'available';
    //   isBookedCell.style.color = isBooked?'#ff0000':'';

    //   var actionCell = 

    //   [idCell, codeCell, isBookedCell].forEach(function (cell) {
    //     row.appendChild(cell);
    //   })
    //   table.appendChild(row);
    // }, this);

    // document.getElementById('rooms').appendChild(table);
  }

  

  socket.on('rooms', function(rooms){
    // document.getElementById('rooms').innerHTML = JSON.stringify(rooms);
    renderRoomsView(rooms);
  })

/*  $(function() {
    $("#loginPanel input").keypress(function (e) {
        if ((e.which && e.which == 13) || (e.keyCode && e.keyCode == 13)) {
            //$('button[type=submit] .default').click();
			login();
            return false;
        } else {
            return true;
        }
    });
  });	*/
</script>
</html>
