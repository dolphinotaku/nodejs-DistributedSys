<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="lib/mustache/mustache.min.js"></script>
</head>
<body>
  <div>
    <input type="text" name="loginId" id="loginId" value="test">
  </div>
  <div>
    <input type="text" name="password" id="password" value="pwd">
  </div>
  <button type="button" onclick="login()">Login</button>

  <div id="rooms-container">

  </div>
  <script id="rooms-view-template" type="x-tmpl-mustache">
      <table id="rooms">
          <tr>
            <th>ID</th>
            <th>Code</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
          {{#rooms}}
          <tr>
            <td>{{id}}</td>
            <td>{{code}}</td>
            <td>
              {{#isBooked}}
                <span class="booked">booked</span>
              {{/isBooked}}
              {{^isBooked}}
                <span>available</span>
              {{/isBooked}}
            </td>
            <td class="text-center">
              {{#canCancel}}
              <button type="button" onclick="cancelRoomBooking({{id}})">Cancel</button>
              {{/canCancel}}
                {{^isBooked}}
              <button type="button" onclick="bookRoom({{id}})">Book</button>
                {{/isBooked}}
            </td>
          </tr>
          {{/rooms}}
        </table>
  </script>

</body>


<script src="/socket.io/socket.io.js"></script>
<script>
  var socket = io();
  
  // setInterval(function(){
    // socket.emit('client',new Date().getTime());
  // }, 1000);
  function login(){
    var loginId = document.getElementById('loginId').value;
    var password = document.getElementById('password').value;
    var account = {'id':loginId, 'password': password};
    console.log(account);

    socket.emit('login', account, function(resp){
      console.log(resp);
      if(resp.success){
        alert('Login success');
      }else{
        alert('Login Fail');
      }
    });
  }

  function bookRoom(id){
    socket.emit('rooms-update', [{'id':id, 'isBooked':true}], function(resp){
      console.log(resp);
    });
  }

  function cancelRoomBooking(id){
    socket.emit('rooms-update', [{'id':id, 'isBooked':false}], function(resp){
      console.log(resp);
    });
  }

  function renderRoomsView(rooms){

    var template = document.getElementById('rooms-view-template').text || '';
    // console.log('template:'+template);
    var loginId = document.getElementById('loginId').value;
    var output = Mustache.render(template, {'rooms':rooms, 'loginId':loginId});

    document.getElementById('rooms-container').innerHTML = output;

    // var table = document.createElement('table');
    // var tr = document.createElement('tr');
    // var td = document.createElement('td');

    // table.style.width = '100%';

    // rooms.forEach(function(room) {
    //   var id = room.id;
    //   var code = room.code;
    //   var isBooked = room.isBooked;

    //   var row = tr.cloneNode(true);

    //   var idCell = td.cloneNode();
    //   idCell.textContent = id;

    //   var codeCell = td.cloneNode();
    //   codeCell.textContent = code;

    //   var isBookedCell = td.cloneNode();
    //   isBookedCell.textContent = isBooked?'booked':'available';
    //   isBookedCell.style.color = isBooked?'#ff0000':'';

    //   var actionCell = 

    //   [idCell, codeCell, isBookedCell].forEach(function (cell) {
    //     row.appendChild(cell);
    //   })
    //   table.appendChild(row);
    // }, this);

    // document.getElementById('rooms').appendChild(table);
  }

  

  socket.on('rooms', function(rooms){
    // document.getElementById('rooms').innerHTML = JSON.stringify(rooms);
    renderRoomsView(rooms);
  })

  
</script>
</html>
